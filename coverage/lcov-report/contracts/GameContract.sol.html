<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\GameContract.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> GameContract.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">78.38% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>29/37</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">41.67% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>5/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">71.43% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>10/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">78.33% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>47/60</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.7;
&nbsp;
import "./MiraiToken.sol";
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";
import "./PriceConvertor.sol";
&nbsp;
contract GameContract {
    using PriceConverter for uint256;
    // Structs
    struct PlayerInfo {
        uint256 id;
        uint256 tokenAmount;
    }
    //Constants
    uint256 constant DECIMALS = 1000000000000000000;
    // Variables
    address private s_owner;
    uint256 private s_numberOfPlayers;
    mapping(address =&gt; PlayerInfo) private s_addressToToken;
    MiraiToken private s_token;
    uint256 immutable i_initialTokenGivenToPlayers;
    uint256 immutable i_initialTokenSupply;
    uint256 immutable i_tokenNeededToPlay;
    AggregatorV3Interface internal s_priceFeed;
    // Events
    event PlayerSigned(address indexed signer);
    event GameStarted(address indexed signer, uint256 indexed remainingToken);
    event TokenBought(
        address indexed signer,
        uint256 indexed tokenAmountBought
    );
    event WinnersPaid(address[] indexed winners, uint256[] indexed prizes);
    // Errors
    error GameContract__PlayerAlreadyExists();
    error GameContract__NotEnoughTokens(address signer);
    error GameContract__AmountTransferFailed();
    error GameContract__NoEthSent();
<span class="fstat-no" title="function not covered" >    modifier onlyOwner() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == s_owner, "You are not the owner")</span>;
        _;
    }
&nbsp;
    constructor(
        uint256 initialTokenGivenToPlayers,
        uint256 tokenNeededToPlay,
        uint256 initialTokenSupply,
        address priceFeed
    ) {
        s_owner = msg.sender;
        i_initialTokenSupply = initialTokenSupply * DECIMALS;
        i_initialTokenGivenToPlayers = initialTokenGivenToPlayers * DECIMALS;
        i_tokenNeededToPlay = tokenNeededToPlay * DECIMALS;
        s_priceFeed = AggregatorV3Interface(priceFeed);
        s_numberOfPlayers = 0;
        s_token = new MiraiToken(i_initialTokenSupply * DECIMALS);
    }
&nbsp;
    // Main functions
    function signIn(address signer) public {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (s_addressToToken[signer].id &gt; 0) {
            revert GameContract__PlayerAlreadyExists();
        }
        s_token.approve(address(this), 20 * DECIMALS);
        s_token.transferFrom(address(this), signer, 20 * DECIMALS);
        s_addressToToken[signer].tokenAmount = 20 * DECIMALS;
        s_addressToToken[signer].id = 1;
        s_numberOfPlayers = s_numberOfPlayers + 1;
        emit PlayerSigned(signer);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function burn(address signer) public returns (uint256 isApproved) {</span>
<span class="cstat-no" title="statement not covered" >        if (s_token.balanceOf(signer) &lt; i_tokenNeededToPlay) {</span>
<span class="cstat-no" title="statement not covered" >            return 0;</span>
        }
<span class="cstat-no" title="statement not covered" >        s_token.transferFrom(address(this), s_owner, i_tokenNeededToPlay)</span>;
        s_addressToToken[signer].tokenAmount =
            s_addressToToken[signer].tokenAmount -
            i_tokenNeededToPlay;
<span class="cstat-no" title="statement not covered" >        emit GameStarted(signer, s_addressToToken[signer].tokenAmount);</span>
<span class="cstat-no" title="statement not covered" >        return 1;</span>
    }
&nbsp;
    function buyToken(address signer) public payable {
        uint256 tokenToTransfer = msg.value.getConversionRate(s_priceFeed);
        if (tokenToTransfer == 0) {
            revert GameContract__NoEthSent();
        }
        s_token.approve(address(this), tokenToTransfer);
        s_token.transferFrom(address(this), signer, tokenToTransfer);
        s_addressToToken[signer].tokenAmount =
            s_addressToToken[signer].tokenAmount +
            tokenToTransfer *
            DECIMALS;
        emit TokenBought(signer, tokenToTransfer);
    }
&nbsp;
    function distributeToken(
        address winner1,
        address winner2,
        address winner3
    ) public payable {
        uint256 totalAmountHeldByContract = address(this).balance;
        uint256 totalAmountToDistribute = (totalAmountHeldByContract * 4) / 5;
        uint256 amountCreditedToOwner = totalAmountHeldByContract -
            totalAmountToDistribute;
        uint256 amountCreditedToFirst = totalAmountToDistribute / 2;
        uint256 amountCreditedToSecond = (totalAmountToDistribute * 3) / 10;
        uint256 amountCreditedToThird = (totalAmountToDistribute) -
            amountCreditedToFirst -
            amountCreditedToSecond;
        // Pay the winners
        address[] memory addresses = new address[](3);
        addresses[0] = winner1;
        addresses[1] = winner2;
        addresses[2] = winner3;
        uint256[] memory prizes = new uint256[](3);
        prizes[0] = amountCreditedToFirst;
        prizes[1] = amountCreditedToSecond;
        prizes[2] = amountCreditedToThird;
        for (uint16 i = 0; i &lt; 3; i++) {
            (bool callSuccess, ) = payable(addresses[i]).call{value: prizes[i]}(
                ""
            );
            <span class="missing-if-branch" title="if path not taken" >I</span>if (!callSuccess) {
                revert GameContract__AmountTransferFailed();
            }
        }
        (bool callSuccess, ) = payable(s_owner).call{
            value: amountCreditedToOwner
        }("");
        <span class="missing-if-branch" title="if path not taken" >I</span>if (!callSuccess) {
            revert GameContract__AmountTransferFailed();
        }
        emit WinnersPaid(addresses, prizes);
    }
&nbsp;
    // Getter functions
    function getPlayerInfo(address signer)
        public
        view
        returns (PlayerInfo memory playerInfo)
    {
        return s_addressToToken[signer];
    }
&nbsp;
    function getTokenNeededToPlay() public view returns (uint256 amount) {
        return i_tokenNeededToPlay;
    }
&nbsp;
    function getInitialTokenGiven() public view returns (uint256 amount) {
        return i_initialTokenGivenToPlayers;
    }
&nbsp;
    function getNumberOfPlayers() public view returns (uint256 number) {
        return s_numberOfPlayers;
    }
&nbsp;
    function getTokenOf(address player) public view returns (uint256 amount) {
        return s_token.balanceOf(player);
    }
&nbsp;
    function getConversion(uint256 amount)
        public
        view
        returns (uint256 convertedAmount)
    {
        return amount.getConversionRate(s_priceFeed);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getTotalTokenSupply() public view returns (uint256 amount) {</span>
<span class="cstat-no" title="statement not covered" >        return s_token.totalSupply();</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getPriceFeedDecimals() public view returns (uint8 decimals) {</span>
<span class="cstat-no" title="statement not covered" >        return s_priceFeed.decimals();</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Nov 08 2022 20:27:49 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
